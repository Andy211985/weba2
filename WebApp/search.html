<!DOCTYPE html>
<html>

<head>
  <title>Search Fundraisers</title>
  <style>
    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>

<body>

  <header>
    <h1>Search Fundraisers</h1>
  </header>

  <nav>
    <a href="/"><span>Home</span></a> |
    <a href="/search"><span>Search</span></a> |
    <a href="/fundraisers"><span>Fundraisers</span></a>
  </nav>

  <section>
    <form id="searchForm">
      <h2>Search Criteria</h2>
      <div>
        <label>
          Organizer:
          <input type="text" id="organizer" name="organizer" />
          <input type="checkbox" name="criteria" value="organizer" />
        </label>
      </div>
      <div>
        <label>
          City:
          <input type="text" id="city" name="city" />
          <input type="checkbox" name="criteria" value="city" />
        </label>
      </div>
      <div>
        <label>
          Category:
          <input type="text" id="category" name="category" />
          <input type="checkbox" name="criteria" value="category" />
        </label>
      </div>
      <br>
      <button type="button" onclick="searchFundraisers()">Search</button>
      <button type="button" onclick="clearCheckboxes()">Clear</button>
    </form>

    <div id="results">
      <!-- Search results will be displayed here -->
    </div>
    <div id="errorMessage" class="error"></div>
  </section>

  <footer>
    <p>Contact us at: 123@123.com</p>
  </footer>

  <script>
    function searchFundraisers() {
      const form = document.getElementById('searchForm');
      const checkboxes = form.querySelectorAll('input[type="checkbox"]:checked');

      if (checkboxes.length === 0) {
        alert("Please select at least one search criteria.");
        return;
      }

      const searchParams = new URLSearchParams();
      checkboxes.forEach(checkbox => {
        const inputField = document.getElementById(checkbox.value);
        if (inputField.value) {
          searchParams.append(checkbox.value, inputField.value);
        }
      });

      fetch(`http://localhost:3060/api/fundraisers/search?${searchParams.toString()}`)
        .then(response => response.json())
        .then(data => displayResults(data))
        .catch(error => {
          console.error('Error fetching fundraisers:', error);
          displayError("An error occurred while searching for fundraisers.");
        });
    }

    function displayResults(fundraisers) {
      const resultsDiv = document.getElementById('results');
      const errorMessageDiv = document.getElementById('errorMessage');

      resultsDiv.innerHTML = '';
      errorMessageDiv.textContent = '';

      if (fundraisers.length === 0) {
        displayError("No fundraisers found matching the selected criteria.");
        return;
      }

      fundraisers.forEach(fundraiser => {
        const fundraiserElement = document.createElement('div');
        fundraiserElement.className = 'fundraiser';
        fundraiserElement.innerHTML = `
          <h3>${fundraiser.CAPTION}</h3>
          <p><strong>Organiser:</strong> ${fundraiser.ORGANIZER}</p>
        `;
        resultsDiv.appendChild(fundraiserElement);
      });
    }

    function displayError(message) {
      const errorMessageDiv = document.getElementById('errorMessage');
      errorMessageDiv.textContent = message;
    }

    function clearCheckboxes() {
      const form = document.getElementById('searchForm');
      const checkboxes = form.querySelectorAll('input[type="checkbox"]');
      const inputFields = form.querySelectorAll('input[type="text"]');

      checkboxes.forEach(checkbox => checkbox.checked = false);
      inputFields.forEach(input => input.value = '');

      document.getElementById('results').innerHTML = '';
      document.getElementById('errorMessage').textContent = '';
    }
  </script>

</body>

</html>
